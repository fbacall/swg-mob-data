<!DOCTYPE html>
<html>
<head>
    <title>SWG Mob Data</title>
    <meta charset="UTF-8">
    <meta name="author" content="fbacall">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: sans-serif;
            font-size: 14px;
        }

        td {
            text-align: center;
        }

        .creature-resource {
            padding: 0 0.5em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: left;
            background: #ddd;
        }

        .creature-resource .yield {
            float: right;
            margin-left: 1em;
        }

        td.left {
            text-align: left;
        }

        .tag {
            border-radius: 2px;
            background: #eee;
            padding: 2px 10px;
            margin: 2px;
            font-size: smaller;
            display: inline-block;
        }

        .armor {
            background: #ccc;
        }

        .mediumdisease, .mediumpoison {
            color: #b1a818;
        }

        .strongdisease, .strongpoison {
            color: #a90a0a;
        }

        .ranged {
            background: #a5edff;
        }

        .no-resist {
            color: #bbb;
        }

        .vulnerable {
            color: #55a632;
        }

        .bronze {
            color: #8d5213;
        }

        .silver {
            color: #778;
        }

        .gold {
            color: #907a33;
        }

        .omg {
            color: #c91414;
        }

        .bone_avian { background-color: #80c4d7; }
        .bone_mammal { background-color: #a9a9a9; }
        .hide_bristley { background-color: #f9b660; }
        .hide_leathery { background-color: #ffd516; }
        .hide_scaley { background-color: #7ed52c; }
        .hide_wooly { background-color: #b08056; }
        .meat_avian { background-color: #80c4d7; }
        .meat_carnivore { background-color: #ff9d93; }
        .meat_domesticated { background-color: #a9a20a; }
        .meat_herbivore { background-color: #aae798; }
        .meat_insect { background-color: #cd9ced; }
        .meat_reptilian { background-color: #f79f23; }
        .meat_wild { background-color: #d27320; }
        .milk_wild { background-color: #cafffe; }
        .milk_domesticated { background-color: #a9a20a; }

        td.planet {
            text-align: center;
            font-weight: bold;
            padding: 0.5em;
        }
        .corellia{ background-color: #b7e9e7; }
        .dantooine{ background-color: #ff00ff; }
        .dathomir{ background-color: #8634ea; }
        .endor{ background-color: #358216; }
        .lok{ background-color: #e9c43b; }
        .naboo{ background-color: #84c267; }
        .rori{ background-color: #ea8050; }
        .talus{ background-color: #4aeecb; }
        .tatooine{ background-color: #ffe100; }
        .yavin4{ background-color: #6aff00; }

        [data-sort] {
            user-select: none;
            cursor: pointer;
        }

        [data-sort]:hover {
            background: #ccccff;
        }

        .sort-desc:after {
            content: '↑';
        }

        .sort-asc:after {
            content: '↓';
        }
    </style>
</head>
<body>

<div class="container">
    <table id="mobs">
        <thead>
            <tr>
                <th data-sort="name">Creature</th>
                <th data-sort="level" class="sort-asc">CL</th>
                <th data-sort="meat">Meat</th>
                <th data-sort="hide">Hide</th>
                <th data-sort="bone">Bone</th>
                <th data-sort="milk">Milk</th>
                <th>Info</th>
                <th data-sort="kinetic_resist">Kin</th>
                <th data-sort="energy_resist">Ene</th>
                <th data-sort="ham">HAM</th>
                <th data-sort="xp">XP</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>Loading</td></tr>
        </tbody>
    </table>
</div>

<script>
    document.addEventListener("DOMContentLoaded", init);
    let planetData = {};
    let sort = 'level';
    let sortDir = 1;
    function init() {
        fetch('data/creatures.json')
            .then((response) => response.json())
            .then((data) => {
                planetData = data;
                draw();
            });
    }

    function draw() {
        const tbody = document.getElementById('mobs').getElementsByTagName('tbody')[0];
        const rows = tbody.rows.length;
        for (let i = 0; i < rows; i++) {
            tbody.deleteRow(0);
        }
        for (const [planet, mobs] of Object.entries(planetData)) {
            const planetRow = tbody.insertRow();
            const planetCell = planetRow.insertCell();
            planetCell.innerText = capitalize(planet);
            planetCell.colSpan = 11;
            planetCell.classList.add('planet', planet);
            applySort(mobs);
            mobs.forEach(function (mob) {
                const row = tbody.insertRow();
                // Name
                const name = row.insertCell();
                let mobName;
                if (mob.type === 'MOB_DROID' || mob.type === 'MOB_ANDROID') {
                    mobName = mob.name.split('_').map(s => s.toUpperCase()).join('-');
                } else {
                    mobName = mob.name.split('_').map(s => capitalize(s)).join(' ');
                }
                name.classList.add('left')
                name.appendChild(document.createTextNode(mobName));
                // CL
                const cl = row.insertCell();
                cl.appendChild(document.createTextNode('' + (mob.level - 2) + ' - ' + (mob.level + 2)));
                // Meat
                drawResource(row.insertCell(), mob.meat_type, mob.meat);
                // Hide
                drawResource(row.insertCell(), mob.hide_type, mob.hide);
                // Bone
                drawResource(row.insertCell(), mob.bone_type, mob.bone);
                // Milk
                drawResource(row.insertCell(), mob.milk_type, mob.milk);
                // Info
                const info = row.insertCell();
                info.classList.add('left');
                // AR
                if (mob.armor && mob.armor > 0) {
                    const ar = document.createElement('span');
                    ar.classList.add('tag', 'armor', 'armor-' + mob.armor);
                    ar.appendChild(document.createTextNode('AR:' + mob.armor));
                    info.appendChild(ar);
                }
                mob.attacks.sort().forEach(attack => {
                    const tag = document.createElement('span');
                    tag.classList.add('tag', attack.split(' ')[0]);
                    let tagText = attack.replace('creaturearea', 'AoE ');
                    tagText = tagText.replace('attack', '');
                    tagText = tagText.replace('mild', '');
                    tagText = tagText.replace('medium', '');
                    tagText = tagText.replace('strong', '');
                    tag.appendChild(document.createTextNode(tagText));
                    info.appendChild(tag);
                });

                // Kinetic
                drawResist(row.insertCell(), mob.kinetic_resist);
                // Energy
                drawResist(row.insertCell(), mob.energy_resist);
                // HAM
                drawNum(row.insertCell(), mob.ham);
                // XP
                drawNum(row.insertCell(), mob.xp);
            });
        }
    }

    function applySort(mobs) {
        let f;
        if (sort === 'name') {
            f = (a, b) => {
                if (a.name.toUpperCase() > b.name.toUpperCase()) {
                    return sortDir;
                }
                if (a.name.toUpperCase() < b.name.toUpperCase()) {
                    return -sortDir;
                }
                return 0;
            }
        } else if (sort === 'meat' || sort === 'bone' || sort === 'hide' || sort === 'milk') {
            const typeVar = sort + '_type';
            f = (a, b) => {
                const aType = a[typeVar] || '0';
                const bType = b[typeVar] || '0';
                if (aType.toUpperCase() > bType.toUpperCase()) {
                    return sortDir;
                }
                if (aType.toUpperCase() < bType.toUpperCase()) {
                    return -sortDir;
                }
                return (a[sort] - b[sort]) * sortDir;
            }
        } else {
            f = (a, b) => (a[sort] - b[sort]) * sortDir;
        }
        mobs.sort(f);
    }

    function drawResource(cell, type, qty) {
        cell.classList.add('creature-resource');
        if (type) {
            cell.classList.add(type);
            const name = type.split('_')[1];
            cell.innerHTML = '<div class="yield">' + qty +'</div>' + capitalize(name);
        }
    }

    function drawResist(cell, resist) {
        if (resist === 0) {
            cell.classList.add('no-resist');
        } else if (resist === 'Vul') {
            cell.classList.add('vulnerable');
        }

        cell.appendChild(document.createTextNode(resist));
    }

    function drawNum(cell, num) {
        let text = num;
        if (num > 1000) {
            text = (num / 1000).toString().substr(0, 3);
            text = text.replace('.0', '');
            if (text[text.length - 1] === '.') // Strip trailing .
                text = text.substring(0, text.length - 1);
            text += 'K';
            if (num > 50000) {
                cell.classList.add('omg');
            } else if (num > 10000) {
                cell.classList.add('gold');
            } else if (num > 5000) {
                cell.classList.add('silver');
            } else {
                cell.classList.add('bronze');
            }
        }

        cell.appendChild(document.createTextNode(text));
    }

    function capitalize(string) {
        return string[0].toUpperCase() + string.slice(1)
    }

    document.getElementById('mobs').addEventListener('click', function (e) {
        if (e.target.dataset.sort) {
            document.querySelectorAll('.sort-desc').forEach(n => n.classList.remove('sort-desc'));
            document.querySelectorAll('.sort-asc').forEach(n => n.classList.remove('sort-asc'));
            if (sort === e.target.dataset.sort) {
                sortDir = sortDir * -1;
            } else {
                sortDir = 1;
                sort = e.target.dataset.sort;
            }
            e.target.classList.add(sortDir === 1 ? 'sort-asc' : 'sort-desc');
            draw();
        }
    });
</script>
</body>
</html>